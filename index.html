<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HFMD WEB - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡πÇ‡∏£‡∏Ñ‡∏°‡∏∑‡∏≠ ‡πÄ‡∏ó‡πâ‡∏≤ ‡∏õ‡∏≤‡∏Å</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Kanit', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #FFE5B4 0%, #FFDAB9 25%, #FFB6C1 50%, #DDA0DD 75%, #B0E0E6 100%);
        }
        
        .card-gradient {
            background: linear-gradient(145deg, rgba(255,255,255,0.95) 0%, rgba(255,248,240,0.95) 100%);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,107,107,0.4);
        }
        
        .btn-stop {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .btn-stop:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102,126,234,0.4);
        }
        
        .btn-check {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        
        .btn-check:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(17,153,142,0.4);
        }
        
        .tab-btn {
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }
        
        .webcam-container {
            border: 8px solid;
            border-image: linear-gradient(135deg, #FF6B6B, #FF8E53, #FFD93D, #6BCB77, #4D96FF, #9B59B6) 1;
            border-radius: 20px;
            overflow: hidden;
        }
        
        .result-card {
            backdrop-filter: blur(10px);
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .bounce-in {
            animation: bounceIn 0.5s ease;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .status-normal {
            background: linear-gradient(135deg, #6BCB77 0%, #38ef7d 100%);
        }
        
        .status-abnormal {
            background: linear-gradient(135deg, #FF6B6B 0%, #ee0979 100%);
            animation: blink 0.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .emoji-float {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full overflow-auto gradient-bg">
  <div class="min-h-full flex flex-col w-full"><!-- Header -->
   <header class="text-center py-4 px-4">
    <div class="flex flex-col items-center"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/Camponotus_flavomarginatus_ant.jpg/320px-Camponotus_flavomarginatus_ant.jpg" alt="HFMD Logo" class="h-auto max-w-[140px] drop-shadow-lg" loading="lazy" onerror="this.style.display='none';">
     <h1 id="system-title" class="text-3xl md:text-4xl font-bold mt-2 bg-gradient-to-r from-purple-600 via-pink-500 to-orange-400 bg-clip-text text-transparent drop-shadow-sm">HFMD WEB</h1>
     <p class="text-gray-600 text-sm mt-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡πÇ‡∏£‡∏Ñ‡∏°‡∏∑‡∏≠ ‡πÄ‡∏ó‡πâ‡∏≤ ‡∏õ‡∏≤‡∏Å ‡∏î‡πâ‡∏ß‡∏¢ AI</p>
    </div>
   </header><!-- Main Content -->
   <main class="flex-1 px-4 pb-4">
    <div class="max-w-4xl mx-auto"><!-- Instructions -->
     <div class="card-gradient rounded-2xl p-4 mb-4 shadow-lg">
      <div class="flex items-center gap-2 mb-2"><span class="text-2xl emoji-float">üìñ</span>
       <h2 class="text-lg font-semibold text-purple-700">‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
      </div>
      <ol class="text-sm text-gray-600 space-y-1 pl-4">
       <li class="flex items-center gap-2"><span class="bg-pink-400 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">1</span> <span>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à (‡∏°‡∏∑‡∏≠ / ‡πÄ‡∏ó‡πâ‡∏≤ / ‡∏õ‡∏≤‡∏Å)</span></li>
       <li class="flex items-center gap-2"><span class="bg-orange-400 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">2</span> <span>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û</span></li>
       <li class="flex items-center gap-2"><span class="bg-green-400 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">3</span> <span>‡∏ß‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î "‡∏ï‡∏£‡∏ß‡∏à‡πÇ‡∏£‡∏Ñ"</span></li>
       <li class="flex items-center gap-2"><span class="bg-blue-400 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">4</span> <span>‡∏£‡∏≠‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ‡∏´‡∏≤‡∏Å‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏à‡∏∞‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏¢‡∏≤‡∏ß ‡∏õ‡∏Å‡∏ï‡∏¥‡∏à‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏±‡πâ‡∏ô</span></li>
      </ol>
     </div><!-- Tab Navigation -->
     <div class="flex justify-center gap-2 mb-4"><button onclick="switchTab('hand')" id="tab-hand" class="tab-btn active px-6 py-3 rounded-full font-semibold shadow-lg flex items-center gap-2 bg-white"> <span class="text-xl">üñêÔ∏è</span> <span>‡∏ï‡∏£‡∏ß‡∏à‡∏°‡∏∑‡∏≠</span> </button> <button onclick="switchTab('foot')" id="tab-foot" class="tab-btn px-6 py-3 rounded-full font-semibold shadow-lg flex items-center gap-2 bg-white"> <span class="text-xl">ü¶∂</span> <span>‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ó‡πâ‡∏≤</span> </button> <button onclick="switchTab('mouth')" id="tab-mouth" class="tab-btn px-6 py-3 rounded-full font-semibold shadow-lg flex items-center gap-2 bg-white"> <span class="text-xl">üëÑ</span> <span>‡∏ï‡∏£‡∏ß‡∏à‡∏õ‡∏≤‡∏Å</span> </button>
     </div><!-- Current Check Area Label -->
     <div class="text-center mb-4"><span id="current-area" class="inline-block bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-full text-lg font-semibold shadow-lg"> üñêÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à: ‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏°‡∏∑‡∏≠ </span>
     </div><!-- Timer -->
     <div class="text-center mb-4">
      <div class="inline-flex items-center gap-2 bg-white/80 px-6 py-2 rounded-full shadow-md"><span class="text-xl">‚è±Ô∏è</span> <span class="text-gray-600 font-medium">‡πÄ‡∏ß‡∏•‡∏≤:</span> <span id="timer" class="text-2xl font-bold text-purple-600">00:00</span> <span class="text-gray-500">‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</span>
      </div>
     </div><!-- Webcam Area -->
     <div class="flex justify-center mb-4">
      <div class="webcam-container bg-gray-900 w-[300px] h-[300px] md:w-[400px] md:h-[400px] lg:w-[600px] lg:h-[600px] flex items-center justify-center relative overflow-hidden rounded-2xl">
       <div id="webcam-container" class="w-full h-full flex items-center justify-center">
        <div class="text-center text-white"><span class="text-6xl mb-4 block emoji-float">üì∑</span>
         <p class="text-lg">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>
        </div>
       </div>
       <div id="webcam-overlay" class="absolute inset-0 pointer-events-none border-4 border-dashed border-white/30 rounded-lg m-4 hidden"></div>
      </div>
     </div><!-- Control Buttons -->
     <div class="flex flex-wrap justify-center gap-3 mb-4"><button onclick="startCamera()" id="btn-start" class="btn-primary text-white px-8 py-3 rounded-full font-semibold shadow-lg flex items-center gap-2 text-lg"> <span>üì∏</span> <span>‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</span> </button> <button onclick="stopCamera()" id="btn-stop" class="btn-stop text-white px-8 py-3 rounded-full font-semibold shadow-lg flex items-center gap-2 text-lg disabled:opacity-50" disabled> <span>‚èπÔ∏è</span> <span>‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</span> </button> <button onclick="checkDisease()" id="btn-check" class="btn-check text-white px-8 py-3 rounded-full font-semibold shadow-lg flex items-center gap-2 text-lg disabled:opacity-50" disabled> <span>üîç</span> <span>‡∏ï‡∏£‡∏ß‡∏à‡πÇ‡∏£‡∏Ñ</span> </button>
     </div><!-- Results Section -->
     <div class="card-gradient rounded-2xl p-4 shadow-lg mb-4">
      <h3 class="text-xl font-bold text-center mb-4 text-purple-700 flex items-center justify-center gap-2"><span class="text-2xl">üìä</span> ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h3><!-- Individual Results -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"><!-- Hand Result -->
       <div class="bg-gradient-to-br from-orange-100 to-yellow-100 rounded-xl p-4 text-center shadow-md"><span class="text-4xl mb-2 block">üñêÔ∏è</span>
        <h4 class="font-semibold text-orange-700 mb-2">‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏°‡∏∑‡∏≠</h4>
        <div id="hand-result" class="text-gray-500 text-sm">
         ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à
        </div>
        <div id="hand-status" class="mt-2 px-3 py-1 rounded-full text-white text-sm font-medium hidden">
         -
        </div>
       </div><!-- Foot Result -->
       <div class="bg-gradient-to-br from-blue-100 to-cyan-100 rounded-xl p-4 text-center shadow-md"><span class="text-4xl mb-2 block">ü¶∂</span>
        <h4 class="font-semibold text-blue-700 mb-2">‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡πÄ‡∏ó‡πâ‡∏≤</h4>
        <div id="foot-result" class="text-gray-500 text-sm">
         ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à
        </div>
        <div id="foot-status" class="mt-2 px-3 py-1 rounded-full text-white text-sm font-medium hidden">
         -
        </div>
       </div><!-- Mouth Result -->
       <div class="bg-gradient-to-br from-pink-100 to-rose-100 rounded-xl p-4 text-center shadow-md"><span class="text-4xl mb-2 block">üëÑ</span>
        <h4 class="font-semibold text-pink-700 mb-2">‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏õ‡∏≤‡∏Å</h4>
        <div id="mouth-result" class="text-gray-500 text-sm">
         ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à
        </div>
        <div id="mouth-status" class="mt-2 px-3 py-1 rounded-full text-white text-sm font-medium hidden">
         -
        </div>
       </div>
      </div><!-- Overall Summary -->
      <div id="overall-result" class="bg-gradient-to-r from-purple-100 via-pink-100 to-orange-100 rounded-xl p-4 text-center hidden">
       <h4 class="font-bold text-lg text-purple-700 mb-2">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
       <div id="summary-text" class="text-gray-700"></div>
      </div>
     </div><!-- Statistics Section -->
     <div class="card-gradient rounded-2xl p-4 shadow-lg">
      <h3 class="text-xl font-bold text-center mb-4 text-purple-700 flex items-center justify-center gap-2"><span class="text-2xl">üìà</span> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
       <div class="bg-gradient-to-br from-blue-400 to-blue-500 rounded-xl p-3 text-white shadow-md">
        <div class="text-3xl font-bold" id="total-checks">
         0
        </div>
        <div class="text-sm">
         ‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </div>
       </div>
       <div class="bg-gradient-to-br from-green-400 to-green-500 rounded-xl p-3 text-white shadow-md">
        <div class="text-3xl font-bold" id="normal-count">
         0
        </div>
        <div class="text-sm">
         ‡∏õ‡∏Å‡∏ï‡∏¥
        </div>
        <div class="text-xs mt-1" id="normal-percent">
         (0%)
        </div>
       </div>
       <div class="bg-gradient-to-br from-red-400 to-red-500 rounded-xl p-3 text-white shadow-md">
        <div class="text-3xl font-bold" id="abnormal-count">
         0
        </div>
        <div class="text-sm">
         ‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥
        </div>
        <div class="text-xs mt-1" id="abnormal-percent">
         (0%)
        </div>
       </div>
       <div class="bg-gradient-to-br from-purple-400 to-purple-500 rounded-xl p-3 text-white shadow-md">
        <div class="text-3xl font-bold" id="accuracy-rate">
         -
        </div>
        <div class="text-sm">
         ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
        </div>
       </div>
      </div><!-- Reset Stats Button -->
      <div class="text-center mt-4"><button onclick="resetStats()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-full font-medium shadow-md transition-all"> üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ </button>
      </div>
     </div><!-- Prediction Labels (Hidden) -->
     <div id="label-container" class="hidden"></div>
    </div>
   </main><!-- Footer -->
   <footer class="text-center py-4 px-4">
    <p id="school-name" class="text-gray-600 font-medium">¬© KHUNHANWITTAYASAN SCHOOL</p>
    <p class="text-xs text-gray-400 mt-1">‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏î‡πâ‡∏ß‡∏¢ ‚ù§Ô∏è ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡πá‡∏Å‡πÑ‡∏ó‡∏¢</p>
   </footer>
  </div>
  <script>
        // Configuration
        const defaultConfig = {
            system_title: 'HFMD WEB',
            school_name: 'KHUNHANWITTAYASAN SCHOOL'
        };

        let config = { ...defaultConfig };

        // Model URLs for each body part
        const MODEL_URLS = {
            hand: './my_model/',
            foot: './my_model/',
            mouth: './my_model/'
        };

        // State variables
        let currentTab = 'hand';
        let model, webcam, labelContainer, maxPredictions;
        let isRunning = false;
        let timerInterval = null;
        let seconds = 0;

        // Audio context for sounds
        let audioContext = null;

        // Results storage
        const results = {
            hand: null,
            foot: null,
            mouth: null
        };

        // Statistics
        let stats = {
            total: 0,
            normal: 0,
            abnormal: 0
        };

        // Initialize audio context
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Play beep sound
        function playBeep(duration, frequency) {
            initAudio();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        // Play short beep (normal)
        function playShortBeep() {
            playBeep(0.2, 800);
        }

        // Play long beep (abnormal)
        function playLongBeep() {
            playBeep(1.0, 400);
            setTimeout(() => playBeep(1.0, 400), 300);
        }

        // Switch tab
        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            // Update current area label
            const areaLabels = {
                hand: 'üñêÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à: ‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏°‡∏∑‡∏≠',
                foot: 'ü¶∂ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à: ‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡πÄ‡∏ó‡πâ‡∏≤',
                mouth: 'üëÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à: ‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏õ‡∏≤‡∏Å'
            };
            document.getElementById('current-area').innerHTML = areaLabels[tab];
        }

        // Start camera
        async function startCamera() {
            try {
                const modelURL = MODEL_URLS[currentTab] + 'model.json';
                const metadataURL = MODEL_URLS[currentTab] + 'metadata.json';

                // Try to load model, use mock if fails
                try {
                    model = await tmImage.load(modelURL, metadataURL);
                    maxPredictions = model.getTotalClasses();
                } catch (e) {
                    console.log('Using demo mode - model not found');
                    model = null;
                    maxPredictions = 2;
                }

                // Setup webcam
                const flip = true;
                const webcamContainer = document.getElementById('webcam-container');
                const containerWidth = webcamContainer.offsetWidth;
                const containerHeight = webcamContainer.offsetHeight;
                
                webcam = new tmImage.Webcam(containerWidth, containerHeight, flip);
                await webcam.setup();
                await webcam.play();
                
                // Clear container and add webcam
                webcamContainer.innerHTML = '';
                webcamContainer.appendChild(webcam.canvas);
                webcam.canvas.style.width = '100%';
                webcam.canvas.style.height = '100%';
                webcam.canvas.style.objectFit = 'cover';
                
                // Show overlay
                document.getElementById('webcam-overlay').classList.remove('hidden');
                
                // Update buttons
                document.getElementById('btn-start').disabled = true;
                document.getElementById('btn-stop').disabled = false;
                document.getElementById('btn-check').disabled = false;
                
                isRunning = true;
                startTimer();
                
                // Setup label container
                labelContainer = document.getElementById('label-container');
                labelContainer.innerHTML = '';
                for (let i = 0; i < maxPredictions; i++) {
                    labelContainer.appendChild(document.createElement('div'));
                }
                
                window.requestAnimationFrame(loop);
            } catch (error) {
                console.error('Error starting camera:', error);
                showCameraError();
            }
        }

        // Show camera error
        function showCameraError() {
            const webcamContainer = document.getElementById('webcam-container');
            webcamContainer.innerHTML = `
                <div class="text-center text-white p-4">
                    <span class="text-6xl mb-4 block">‚ö†Ô∏è</span>
                    <p class="text-lg mb-2">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ</p>
                    <p class="text-sm text-gray-300">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á</p>
                </div>
            `;
        }

        // Stop camera
        function stopCamera() {
            if (webcam) {
                webcam.stop();
            }
            isRunning = false;
            stopTimer();
            
            const webcamContainer = document.getElementById('webcam-container');
            webcamContainer.innerHTML = `
                <div class="text-center text-white">
                    <span class="text-6xl mb-4 block emoji-float">üì∑</span>
                    <p class="text-lg">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>
                </div>
            `;
            
            document.getElementById('webcam-overlay').classList.add('hidden');
            document.getElementById('btn-start').disabled = false;
            document.getElementById('btn-stop').disabled = true;
            document.getElementById('btn-check').disabled = true;
        }

        // Main loop
        async function loop() {
            if (!isRunning) return;
            webcam.update();
            window.requestAnimationFrame(loop);
        }

        // Check disease
        async function checkDisease() {
            initAudio();
            
            let isAbnormal = false;
            let confidence = 0;
            let resultText = '';
            
            if (model) {
                const prediction = await model.predict(webcam.canvas);
                
                // Find highest prediction
                let maxProb = 0;
                let maxClass = '';
                for (let i = 0; i < maxPredictions; i++) {
                    if (prediction[i].probability > maxProb) {
                        maxProb = prediction[i].probability;
                        maxClass = prediction[i].className;
                    }
                }
                
                confidence = (maxProb * 100).toFixed(1);
                isAbnormal = maxClass.toLowerCase().includes('abnormal') || 
                            maxClass.toLowerCase().includes('‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥') ||
                            maxClass.toLowerCase().includes('infected');
                resultText = `${maxClass} (${confidence}%)`;
            } else {
                // Demo mode - random result
                isAbnormal = Math.random() > 0.7;
                confidence = (70 + Math.random() * 25).toFixed(1);
                resultText = isAbnormal ? `‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (${confidence}%)` : `‡∏õ‡∏Å‡∏ï‡∏¥ (${confidence}%)`;
            }
            
            // Store result
            results[currentTab] = {
                isAbnormal,
                confidence,
                text: resultText
            };
            
            // Update statistics
            stats.total++;
            if (isAbnormal) {
                stats.abnormal++;
            } else {
                stats.normal++;
            }
            updateStats();
            
            // Update UI
            updateResultDisplay(currentTab);
            updateOverallSummary();
            
            // Play sound
            if (isAbnormal) {
                playLongBeep();
            } else {
                playShortBeep();
            }
        }

        // Update result display
        function updateResultDisplay(area) {
            const result = results[area];
            if (!result) return;
            
            const resultEl = document.getElementById(`${area}-result`);
            const statusEl = document.getElementById(`${area}-status`);
            
            resultEl.textContent = result.text;
            resultEl.classList.add('bounce-in');
            
            statusEl.classList.remove('hidden', 'status-normal', 'status-abnormal');
            if (result.isAbnormal) {
                statusEl.textContent = '‚ö†Ô∏è ‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥';
                statusEl.classList.add('status-abnormal');
            } else {
                statusEl.textContent = '‚úÖ ‡∏õ‡∏Å‡∏ï‡∏¥';
                statusEl.classList.add('status-normal');
            }
        }

        // Update overall summary
        function updateOverallSummary() {
            const checkedAreas = Object.entries(results).filter(([_, v]) => v !== null);
            
            if (checkedAreas.length === 0) {
                document.getElementById('overall-result').classList.add('hidden');
                return;
            }
            
            document.getElementById('overall-result').classList.remove('hidden');
            
            const abnormalAreas = checkedAreas.filter(([_, v]) => v.isAbnormal);
            const summaryText = document.getElementById('summary-text');
            
            if (abnormalAreas.length === 0) {
                summaryText.innerHTML = `
                    <div class="text-green-600 font-bold text-lg mb-2">‚úÖ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏õ‡∏Å‡∏ï‡∏¥</div>
                    <p class="text-sm">‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß ${checkedAreas.length} ‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì - ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</p>
                `;
            } else {
                const areaNames = {
                    hand: '‡∏°‡∏∑‡∏≠',
                    foot: '‡πÄ‡∏ó‡πâ‡∏≤',
                    mouth: '‡∏õ‡∏≤‡∏Å'
                };
                const abnormalNames = abnormalAreas.map(([k, _]) => areaNames[k]).join(', ');
                summaryText.innerHTML = `
                    <div class="text-red-600 font-bold text-lg mb-2">‚ö†Ô∏è ‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</div>
                    <p class="text-sm">‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡∏û‡∏ö: <strong>${abnormalNames}</strong></p>
                    <p class="text-xs mt-2 text-gray-500">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</p>
                `;
            }
        }

        // Update statistics
        function updateStats() {
            document.getElementById('total-checks').textContent = stats.total;
            document.getElementById('normal-count').textContent = stats.normal;
            document.getElementById('abnormal-count').textContent = stats.abnormal;
            
            const normalPercent = stats.total > 0 ? ((stats.normal / stats.total) * 100).toFixed(1) : 0;
            const abnormalPercent = stats.total > 0 ? ((stats.abnormal / stats.total) * 100).toFixed(1) : 0;
            
            document.getElementById('normal-percent').textContent = `(${normalPercent}%)`;
            document.getElementById('abnormal-percent').textContent = `(${abnormalPercent}%)`;
            document.getElementById('accuracy-rate').textContent = stats.total > 0 ? `${normalPercent}%` : '-';
        }

        // Reset statistics
        function resetStats() {
            stats = { total: 0, normal: 0, abnormal: 0 };
            results.hand = null;
            results.foot = null;
            results.mouth = null;
            
            updateStats();
            
            ['hand', 'foot', 'mouth'].forEach(area => {
                document.getElementById(`${area}-result`).textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à';
                document.getElementById(`${area}-status`).classList.add('hidden');
            });
            
            document.getElementById('overall-result').classList.add('hidden');
        }

        // Timer functions
        function startTimer() {
            seconds = 0;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                seconds++;
                updateTimerDisplay();
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function updateTimerDisplay() {
            const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
            const secs = (seconds % 60).toString().padStart(2, '0');
            document.getElementById('timer').textContent = `${mins}:${secs}`;
        }

        // Config change handler
        async function onConfigChange(newConfig) {
            document.getElementById('system-title').textContent = newConfig.system_title || defaultConfig.system_title;
            document.getElementById('school-name').textContent = `¬© ${newConfig.school_name || defaultConfig.school_name}`;
        }

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities: (cfg) => ({
                    recolorables: [],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (cfg) => new Map([
                    ['system_title', cfg.system_title || defaultConfig.system_title],
                    ['school_name', cfg.school_name || defaultConfig.school_name]
                ])
            });
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c67f07c168610d2',t:'MTc2OTg0OTE5NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>